---
title: "Final Project"
author: "Mathias Heinz"
date: "2024-04-8"
categories: [code, analysis]

---
```{r}
library(tidyverse)
library(shiny)
library(plotly)

wine_ratings <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-28/winemag-data-130k-v2.csv")


```

```{r}


wine_clean <- wine_ratings |> filter(variety == "Cabernet Sauvignon" 
                                     | variety == "Pinot Noir" | variety == "Merlot" 
                                     | variety == "Chardonnay" | variety == "Sauvignon Blanc"
                                     | variety == "Pinot Gris" |  variety == "Reisling"                           | variety == "Red Blend"
                                     | variety == "White Blend" | variety == "Malbec"
                                     | variety == "Rosé" | variety == "Moscato"
                                     | variety == "Prosecco" | variety == "Tempranillo"
                                     | variety == "Syrah" | variety == "Shiraz"
                                     | variety == "Zinfandel") |> 
  mutate(r_w = case_when(variety == "Chardonnay" 
                          | variety == "Sauvignon Blanc" 
                          | variety == "Pinot Gris" 
                          | variety == "Reisling" 
                          | variety == "White Blend"
                          | variety == "Moscato"
                          | variety == "Rosé"
                          | variety == "Prosecco" ~ "White",
         variety == "Cabernet Sauvignon" | variety == "Pinot Noir"
         | variety == "Merlot" | variety == "Red Blend" | 
           variety == "Malbec" | variety == "Tempranillo" |
           variety == "Syrah" | variety == "Shiraz" |
           variety == "Zinfandel" ~ "Red"))
grape_sel <- wine_clean |> distinct(variety) |> pull(variety)
country_sel <- wine_clean |> distinct(country) |> pull(country)
wine_ratings |> distinct(variety) |> pull(variety)
wine_ratings |> filter(variety == "Zinfandel")
wine_clean |> filter(!is.na(price)) |> summarise(min(price))
wine_clean |> filter(!is.na(price)) |> summarise(max(price))
## Of the 707 varieties in the data set I have collected 17 of the most popular grape varieties, leaving me with almost 60,000 observations.
sh <- wine_clean |> filter(variety == "Shiraz") |> filter(country == "Italy")
oregon_pn <- wine_clean |> filter(country == "US") |> 
  filter(variety == "Pinot Noir") |> 
  filter(price >= 20 & price <= 50) |> 
  filter(province == "Oregon")

ggplot(oregon_pn, aes(x = price, y = points))+
  geom_hex()
wine_clean |> filter(country == "France") |> filter(variety == "Chardonay")

ggplot(data = wine_clean |> filter(r_w == "Red"), aes(x = variety))+
  geom_bar(aes(color = country))+
  scale_color_viridis_d()
```

Plots for Analysis

## Italy Analysis
```{r}
wine_i <- wine_clean |> filter(country == "Italy") |> filter(!is.na(variety))
ggplot(wine_i, aes(x = price, y = points))+
  geom_hex()+
  facet_wrap(~r_w)+
  scale_color_viridis_c()

  
ggplot(wine_clean |> filter(country == "Italy") |> filter(r_w == "Red"), 
       aes(x = variety))+
  geom_bar()

ggplot(wine_clean |> filter(country == "Italy") |> filter(r_w == "White"), 
       aes(x = variety))+
  geom_bar()
```
The country of Italy appears to produce mainly Red Blend and White Blend wines. Italy produces over 300 different Red Blend varieties, and just under 800 varieties of White Blend wines. In the production of white wines, Prosecco (a sparkling white wine) and Moscato (a sweet white wine) are then next most produced, both around 200 varieties. The majority of Italian wines score between 85 and 90 points, while having a price per bottle around $25.

## France Anaylsis
```{r}
wine_f <- wine_clean |> filter(country == "France") |> filter(!is.na(variety))
ggplot(wine_f, aes(x = price, y = points))+
  geom_hex()+
  scale_color_viridis_c()

  
ggplot(wine_clean |> filter(country == "France") |> filter(r_w == "Red"), 
       aes(x = variety))+
  geom_bar()
  
ggplot(wine_clean |> filter(country == "France") |> filter(r_w == "White"), 
       aes(x = variety))+
  geom_bar()
france_cs <- wine_clean |> filter(country == "France") |> 
  filter(variety == "Cabernet Sauvignon")

france_plot <- ggplot(data = france_cs, aes(x = price, y = points, label = title))+
  geom_point()+
  geom_jitter(width = .05)
  theme_minimal()

ggplotly(france_plot, tooltip = "label")
```

## US Analysis
```{r}
wine_u <- wine_clean |> filter(country == "US") |> filter(!is.na(variety))
ggplot(wine_u, aes(x = price, y = points))+
  geom_hex()+
  scale_color_viridis_c()

  
ggplot(wine_clean |> filter(country == "US"), aes(x = variety))+
  geom_bar()+
  facet_wrap(~r_w)

cali_cs <- wine_clean |> filter(country == "US") |> 
  filter(variety == "Cabernet Sauvignon") |> 
  filter(province == "California")

ggplot(cali_cs, aes(x = price, y = points))+
  geom_hex()+
  theme_minimal()
```

## New Zealand Analysis
```{r}
wine_n <- wine_clean |> filter(country == "New Zealand") |> filter(!is.na(variety))


  
ggplot(wine_clean |> filter(country == "New Zealand") |> filter(r_w == "Red"), 
       aes(x = variety))+
  geom_bar()

ggplot(wine_clean |> filter(country == "New Zealand") |> filter(r_w == "White"), 
       aes(x = variety))+
  geom_bar()

newz_sb <- wine_clean |> filter(country == "New Zealand") |> 
  filter(variety == "Sauvignon Blanc")
ggplot(newz_sb, aes(x = price, y = points))+
  geom_hex()+
  scale_color_viridis_c()

```


### Written Report Start

Abstract: 

Introduction: For this project I wanted to explore wine production around the world. My overall goal was to look at some of the biggest wine producing regions, and see what type of wines they are producing, and the quality of these wines. The data set I started with had over 150,000 observations, on numerous countries and grape varieties, so I choose to filter the data set down to 17 varieties with a little under 60,000 observations. From this cleaned data set I focused on the variables "country", "variety", "points", "price", and sometimes "region".




```{r}
ui <- navbarPage("Wine of the World",
  sidebarLayout(
    sidebarPanel(
      selectInput("country_sel", label = "Choose a Country", 
                                 choices = country_sel),
      radioButtons("white_or_red", label = "Red or White",
                                  choices = c("Red", "White")),
      selectInput("grape_sel", label = "Choose a Grape",
                                 choices = grape_sel),
      sliderInput("price_range", label = "Choose a Minimum Price",
                                 min = 4, max = 2500, 
                  value = c(4,2500), step = 1)
    ),
    mainPanel(
      tabsetPanel(
        tabPanel("Hex Plot", plotOutput("wine_plot")),
        tabPanel("Wine Point", plotlyOutput("wine_point")),
  tabPanel("Wine Table", tableOutput("wine_table")),
  tabPanel("Bar Graph", plotOutput("wine_bar"))
      )
    )
  ))

server <- function(input, output, session) {
  observeEvent(input$white_or_red, {
   grape_sel <- wine_clean |> filter(r_w == input$white_or_red) |> distinct(variety) |> pull(variety)
   
   updateSelectInput(inputId = "grape_sel",
                     choices = grape_sel)
 })
  observeEvent(input$country_sel,{
    grape_sel <- wine_clean |> filter(r_w == input$white_or_red) |> filter(country == input$country_sel) |> distinct(variety) |> pull(variety)
    updateSelectInput(inputId = "grape_sel",
                      choices = grape_sel)
  })
   wine_df <- reactive({
    wine_one <- wine_clean |> filter(country == input$country_sel) |> 
  filter(variety == input$grape_sel) |> 
  filter(price >= input$price_range[1] & price <= input$price_range[2])
  })
   wine_bar <- reactive({
     wine_clean |> filter(country == input$country_sel) |> 
     filter(r_w == input$white_or_red)
   })
   output$wine_bar <- renderPlot({
    ggplot(wine_bar(), aes(x = variety))+
  geom_bar()+
  facet_wrap(~r_w)+
       coord_flip()
   })
  output$wine_table <- renderTable({
    wine_df()
  })
  output$wine_plot <- renderPlot({
    ggplot(wine_df(), aes(x = price, y = points))+
  geom_hex()+
  scale_color_viridis_c()+
  labs(title = glue::glue("Graph of Price vs Score for ", input$grape_sel, 
                          " Wines from ", input$country_sel ))
  })
  output$wine_point <- renderPlotly({
    ggplot(data = wine_df(), aes(x = price, y = points, label = title))+
      geom_point()+
      theme_minimal()+
      labs(title = glue::glue("Graph of Price vs Score for ", 
                              input$grape_sel, " Wines from ", input$country_sel ))
    
  })
}

shinyApp(ui, server)
```
